---
phase: 11-error-recovery-resume
plan: 03
type: tdd
domain: go-cli
---

<objective>
Add --resume flag to run, queue, and epic commands for resuming from saved state.

Purpose: Allow users to resume failed workflows from the command line.
Output: CLI commands with --resume flag support and state-enabled executor.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-error-recovery-resume/11-01-SUMMARY.md
@.planning/phases/11-error-recovery-resume/11-02-SUMMARY.md
@internal/cli/run.go
@internal/cli/epic.go
@internal/cli/queue.go
@internal/cli/root.go

**Dependencies:**

- 11-01 provides: state package with Save, Load, Clear, Exists
- 11-02 provides: executor.ExecuteWithResume, StateManager interface

**Design decisions:**

- --resume flag on run, queue, epic commands (default: false)
- When --resume: use ExecuteWithResume instead of Execute
- Real StateManager implementation wraps state package functions
- StateManager injected via App struct for testability
- Error message when --resume but no saved state (from state.ErrNoState)
- Clear messaging: "Resuming from step X of Y for story Z"
  </context>

<feature>
  <name>CLI Resume Flag</name>
  <files>internal/cli/run.go, internal/cli/queue.go, internal/cli/epic.go, internal/cli/root.go, internal/cli/run_test.go, internal/cli/queue_test.go, internal/cli/epic_test.go</files>
  <behavior>
    New StateManager implementation:
    - internal/state/manager.go - implements lifecycle.StateManager interface
    - Wraps state.Save, state.Load, state.Clear functions

    App struct changes:
    - Add StateManager field (lifecycle.StateManager interface)
    - NewApp creates real StateManager

    run command:
    - Add --resume flag (bool, default false)
    - If --resume: call executor.ExecuteWithResume(ctx, storyKey)
    - If not --resume: call executor.Execute(ctx, storyKey) (existing behavior)
    - Always create executor with state manager for state tracking

    queue command:
    - Add --resume flag (applies to first story only)
    - If --resume: first story uses ExecuteWithResume, rest use Execute
    - Rationale: resume applies to the failed story, subsequent stories run fresh

    epic command:
    - Same as queue: --resume applies to first story only

    Cases:
    - run --resume with saved state resumes from step index
    - run --resume with no saved state returns helpful error
    - run without --resume starts fresh (but still saves state on failure)
    - queue --resume resumes first story, runs rest normally
    - epic --resume resumes first story, runs rest normally
    - State cleared after successful story completion

  </behavior>
  <implementation>
    1. Create internal/state/manager.go with Manager struct implementing lifecycle.StateManager
    2. Add StateManager to App struct and NewApp
    3. Update run.go: add --resume flag, conditional ExecuteWithResume call
    4. Update queue.go: add --resume flag, first-story resume logic
    5. Update epic.go: add --resume flag, first-story resume logic
    6. Update all test files with mock StateManager
  </implementation>
</feature>

<verification>
go test ./internal/cli/... -v
go test ./internal/state/... -v
</verification>

<success_criteria>

- All tests pass
- run --resume resumes from saved state
- run (no flag) saves state on failure
- queue/epic --resume works for first story
- Clear error message when no state to resume
  </success_criteria>

<output>
After completion, create `.planning/phases/11-error-recovery-resume/11-03-SUMMARY.md`:

# Phase 11 Plan 03: CLI --resume Flag Summary

**[One-liner describing what shipped]**

## Performance

- Duration: X min
- TDD Phases: RED, GREEN, REFACTOR (if any)

## RED Phase

[What tests were written, why they failed]

## GREEN Phase

[What implementation made them pass]

## REFACTOR Phase (if any)

[What cleanup was done]

## Files Created/Modified

- `internal/state/manager.go` - StateManager implementation
- `internal/cli/run.go` - --resume flag
- `internal/cli/queue.go` - --resume flag
- `internal/cli/epic.go` - --resume flag
- `internal/cli/root.go` - StateManager in App
- Test files updated

## Decisions Made

[Any decisions during implementation]

## Issues Encountered

[Any issues and resolutions]

## Next Phase Readiness

[Phase 11 complete, ready for Phase 12: Dry Run Mode]
</output>
